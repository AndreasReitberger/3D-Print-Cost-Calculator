<UserControl x:Class="PrintCostCalculator3d.Views.Dashboard.DashboardCalculatorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             
             xmlns:local="clr-namespace:PrintCostCalculator3d"
             xmlns:CustomControls="clr-namespace:PrintCostCalculator3d.Controls"       
             xmlns:dialogs="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"       
             xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:viewModels="clr-namespace:PrintCostCalculator3d.ViewModels.Dashboard"
             xmlns:converters="clr-namespace:PrintCostCalculator3d.Converters"
             xmlns:validators="clr-namespace:PrintCostCalculator3d.Validators"
             xmlns:templates="clr-namespace:PrintCostCalculator3d.Templates"
             xmlns:behaviors="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:localization="clr-namespace:PrintCostCalculator3d.Resources.Localization"
             xmlns:Enums="clr-namespace:AndreasReitberger.Enums;assembly=3dPrintCalculatorLibrary"
             
             dialogs:DialogParticipation.Register="{Binding}"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance viewModels:DashboardCalculatorViewModel}"
             >
    <UserControl.Resources>
        <ObjectDataProvider x:Key="Units" MethodName="GetValues" ObjectType="{x:Type Enums:Unit}">
            <ObjectDataProvider.MethodParameters>
                <x:Type Type="Enums:Unit"/>
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>

        <converters:ColorToStringConverter x:Key="ColorToStringConverter" />
        <converters:StringToColorConverter x:Key="StringToColorConverter" />
        <converters:IsObjectNullToBoolConverter x:Key="IsObjectNullToBoolConverter" />
        <converters:MoreThanXSelectedConverter x:Key="MoreThanXSelectedConverter" />
        <converters:IsMoreOrEqualThanConverter x:Key="IsMoreOrEqualThanConverter" />
        <converters:DecimalHoursToTimeSpanConverter x:Key="DecimalHoursToTimeSpanConverter" />
        <converters:BooleanToVisibilityCollapsedConverter x:Key="BooleanToVisibilityCollapsedConverter" />
        <converters:BooleanToVisibilityCollapsedReverseConverter x:Key="BooleanToVisibilityCollapsedReverseConverter" />
        <converters:BooleanReverseConverter x:Key="BooleanReverseConverter" />
        <converters:EnumDescriptionConverter x:Key="EnumDescriptionConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="180"/>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="60"/>
            </Grid.RowDefinitions>
            <!-- TabControl for diffrent information -->
            <TabControl 
                Style="{StaticResource DefaultTabControl}" 
                SelectedIndex="{Binding SelectedMainTab}"

                Margin="5" Grid.Column="0" Grid.ColumnSpan="5">
                <!-- General -->
                <TabItem Header="{x:Static localization:Strings.General}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <!-- Header information -->
                        <StackPanel>
                            <!-- Selected Calculation -->
                            <DockPanel>
                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=CalculatorVariant}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                                <Label Content="{x:Static localization:Strings.LabelSelectedCaculation}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                <Button Margin="5,5,52,5" VerticalAlignment="Top" Height="35" Width="45"
                                        DockPanel.Dock="Right"
                                        Command="{Binding NewCalculationCommand}" 
                                        CommandParameter="{Binding ElementName=cbCalculation, Path=SelectedItem}"
                                        ToolTip="{x:Static localization:Strings.Clear}"
                                    >
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ImageButton}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Style.Triggers>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=NotificationClearAll}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>

                                    </Grid>
                                </Button>

                                <ComboBox x:Name="cbCalculation" SelectedItem="{Binding Calculation}" 
                                            ItemsSource="{Binding Calculations}" Height="38" Margin="5"
                                            >
                                    <ComboBox.Style>
                                        <Style TargetType="ComboBox" BasedOn="{StaticResource DefaultComboBox}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Calculations.Count}" Value="0">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ComboBox.Style>
                                    <!-- Mahapps 2.x -->
                                    <behaviors:Interaction.Triggers>
                                        <behaviors:EventTrigger EventName="SelectionChanged" >
                                            <behaviors:InvokeCommandAction Command="{Binding SelectedCalculationChangedCommand}" 
                                                                            CommandParameter="{Binding Path=SelectedItem, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ComboBox}}"/>
                                        </behaviors:EventTrigger>
                                    </behaviors:Interaction.Triggers>
                                </ComboBox>
                            </DockPanel>

                            <!-- Project name -->
                            <DockPanel>
                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=RenameBox}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                                <Label Content="{x:Static localization:Strings.LabelProjectNameMandatory}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                <Label Width="92" DockPanel.Dock="Right" Margin="5"/>
                                <TextBox x:Name="tbName"  Margin="5" Width="Auto" HorizontalAlignment="Stretch">
                                    <TextBox.Text>
                                        <Binding Path="Name" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                            <Binding.ValidationRules>
                                                <validators:EmptyValidator ValidatesOnTargetUpdated="True" />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </TextBox.Text>
                                </TextBox>
                            </DockPanel>

                            <!-- Selected Gcodes -->
                            <DockPanel>
                                <!-- Help info 
                                <Rectangle 
                                    VerticalAlignment="Top"
                                    DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.HelpTextNewGcodeSelectionMethod}" 
                                    Style="{StaticResource HelpImageRectangle}" Margin="10">
                                    <Rectangle.Resources>
                                        <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                    </Rectangle.Resources>
                                </Rectangle>-->
                                <!-- Icon -->
                                <Rectangle 
                                    VerticalAlignment="Top"
                                    Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" 
                                    Margin="10,10,0,10">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=FileMultipleOutline}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                                <!-- Label -->
                                <Label 
                                    VerticalAlignment="Top"
                                    Content="{x:Static localization:Strings.LabelGcodeOrPrintInformation}" 
                                    Margin="2,10" MinWidth="160"/>
                                <!-- Add manual file information -->
                                <Button 
                                    Margin="5" 
                                    VerticalAlignment="Top" Height="35" Width="45"
                                    DockPanel.Dock="Right"
                                    Command="{Binding AddPrintInformationManuallyCommand}" 
                                    ToolTip="{x:Static localization:Strings.AddManuelPrintFileInformation}"
                                    >
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ImageButton}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                        </Style>
                                    </Button.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=PlaylistPlus}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>

                                    </Grid>
                                </Button>
                                <!-- Select from list -->
                                <Button 
                                    Margin="5" 
                                    VerticalAlignment="Top" Height="35" Width="45"
                                    DockPanel.Dock="Right"
                                    Command="{Binding SelectGcodeFromListCommand}" 
                                    ToolTip="{x:Static localization:Strings.ToolTip_AddGcodeFromList}"
                                    >
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource ImageButton}">
                                            <Setter Property="IsEnabled" Value="True"/>
                                        </Style>
                                    </Button.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                            <Rectangle.OpacityMask>
                                                <VisualBrush Stretch="Uniform" Visual="{iconPacks:Modern Kind=ListAdd}" />
                                            </Rectangle.OpacityMask>
                                        </Rectangle>

                                    </Grid>
                                </Button>

                                <!-- Collapse / Expand button -->
                                <DockPanel DockPanel.Dock="Top" >
                                    <CheckBox 
                                        IsChecked="{Binding ShowSelectedFiles}" 
                                        Style="{StaticResource MahApps.Styles.ToggleButton.TreeViewItem.ExpandCollapse}"/>
                                    <Controls:Badged 
                                        DockPanel.Dock="Left"
                                        Margin="10,5"
                                        BadgePlacementMode="Left" 
                                        Badge="{Binding Files.Count}">
                                        <TextBlock 
                                            Margin="20,0,0,0"
                                            FontSize="16"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock" BasedOn="{StaticResource DefaultTextBlock}">
                                                    <Setter Property="Text" Value="{x:Static localization:Strings.Files}"/>

                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                    </Controls:Badged>
                                </DockPanel>
                            </DockPanel>

                            <!-- Selected Files -->
                            <Grid 
                                Visibility="{Binding ShowSelectedFiles, 
                                    Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                DockPanel.Dock="Top"
                                Margin="5"
                                >
                                <!-- Show files if any -->
                                <ScrollViewer>
                                    <ScrollViewer.Style>
                                        <Style TargetType="ScrollViewer" BasedOn="{StaticResource DefaultScrollViewer}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Files.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ScrollViewer.Style>
                                    <!-- SelectedItemsList="{Binding SelectedFilesList}" -->
                                    <CustomControls:MultiSelectDataGrid
                                        ItemsSource="{Binding Files}"
                                        Style="{StaticResource DefaultDataGrid}"
                                        CanUserAddRows="False"
                                        CanUserDeleteRows="True"
                                        AutoGenerateColumns="False"
                                        IsReadOnly="False"
                                        >
                                        <CustomControls:MultiSelectDataGrid.Columns>
                                            <DataGridTextColumn 
                                                    Header="{x:Static localization:Strings.FileName}"
                                                    Binding="{Binding FileName}"/>
                                            <!-- Binding="{Binding PrintTime, Converter={StaticResource DecimalHoursToTimeSpanConverter}}"-->
                                            <Controls:DataGridNumericUpDownColumn 
                                                    Header="{x:Static localization:Strings.PrintTime}"
                                                    Binding="{Binding PrintTime}"
                                                
                                                />
                                            <!-- Binding="{Binding Volume, StringFormat={}{0} cm³}" -->
                                            <Controls:DataGridNumericUpDownColumn 
                                                    Header="{x:Static localization:Strings.Volume}"
                                                    Binding="{Binding Volume}"
                                                    StringFormat="{}{0} cm³"
                                                />
                                            <!-- Binding="{Binding Weight.Weight}"  -->
                                            <Controls:DataGridNumericUpDownColumn 
                                                Header="{x:Static localization:Strings.Weight}"
                                                Binding="{Binding Weight.Weight}"
                                                />

                                            <DataGridComboBoxColumn
                                                Header="{x:Static localization:Strings.Unit}"
                                                SelectedItemBinding="{Binding Weight.Unit}"
                                                ItemsSource="{Binding Source={StaticResource Units}}"
                                                />
                                            <DataGridTextColumn 
                                                Header="{x:Static localization:Strings.WeightInGramm}"
                                                Binding="{Binding Weight.WeightInGramm, StringFormat={}{0} g}"
                                                IsReadOnly="True"
                                                />
                                            
                                            <Controls:DataGridNumericUpDownColumn
                                                Header="{x:Static localization:Strings.Quantity}"
                                                Binding="{Binding Quantity}"
                                                Minimum="1"
                                                />
                                        </CustomControls:MultiSelectDataGrid.Columns>
                                    </CustomControls:MultiSelectDataGrid>
                                </ScrollViewer>
                                <!-- If no files added -->
                                <TextBlock
                                    Text="{x:Static localization:Strings.NoFileAddedPleaseAddOneFirst}"
                                    VerticalAlignment="Center"
                                    HorizontalAlignment="Center"
                                    FontSize="12"
                                    FontStyle="Italic"
                                    >
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock" BasedOn="{StaticResource AccentTextBlock}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Files.Count}" Value="0">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Grid>
                        </StackPanel>

                        <!-- Calculation information -->
                        <ScrollViewer 
                            Grid.Row="1"
                            Margin="0,24,0,0"
                            >
                            <StackPanel>
                                <!-- Energy Costs -->
                                <GroupBox
                                    Margin="0,2">
                                    <GroupBox.Style>
                                        <Style TargetType="GroupBox" BasedOn="{StaticResource WithoutHeaderGroupBox}">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <DataTrigger 
                                                Binding="{Binding ElementName=tglGeneralEnergyCosts, Path=IsChecked }"
                                                Value="True"
                                                >
                                                    <Setter Property="BorderThickness" Value="1"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </GroupBox.Style>
                                    <StackPanel>
                                        <DockPanel>
                                            <Rectangle 
                                                DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.ApplyEnergyCostsNote}" 
                                                Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                <Rectangle.Resources>
                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                </Rectangle.Resources>
                                            </Rectangle>


                                            <ToggleButton 
                                                x:Name="tglGeneralEnergyCosts"
                                                DockPanel.Dock="Right"
                                                Style="{StaticResource EditToggleButton}"/>

                                            <CheckBox 
                                                x:Name="cbkApplyEnergyCosts" 
                                                Content="{x:Static localization:Strings.ApplyEnergyCostsToCalculation}" 
                                                IsChecked="{Binding ApplyEnergyCosts}" Margin="2,5,5,5" MinHeight="32"/>

                                        </DockPanel>
                                        <!-- Settings -->
                                        <StackPanel
                                            Visibility="{Binding ElementName=tglGeneralEnergyCosts, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                            >
                                            <!-- Energy costs -->
                                            <DockPanel>
                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                    <Rectangle.OpacityMask>
                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=PowerPlug}" />
                                                    </Rectangle.OpacityMask>
                                                </Rectangle>
                                                <Label Content="{x:Static localization:Strings.LabelEnergyCostsMandatory}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                                <Label Content="ct/kWh" DockPanel.Dock="Right" Margin="5" MinWidth="92"/>
                                                <!-- Mahapps 1.6 HasDecimals="False" -->
                                                <Controls:NumericUpDown StringFormat="C2" Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    ToolTip="{x:Static localization:Strings.TooltipEnergyCosts}"
                                                                    >
                                                    <Controls:NumericUpDown.Value>
                                                        <Binding Path="EnergyCosts" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </Controls:NumericUpDown.Value>
                                                </Controls:NumericUpDown>
                                            </DockPanel>
                                            <!-- Power Consumption slider -->
                                            <DockPanel>
                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                    <Rectangle.OpacityMask>
                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=PowerSettings}" />
                                                    </Rectangle.OpacityMask>
                                                </Rectangle>
                                                <Label Content="{x:Static localization:Strings.LabelPowerLevel}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                                <Label Content="{x:Static localization:StaticStrings.Percent}" Margin="5" DockPanel.Dock="Right" MinWidth="92"/>
                                                <!-- Mahapps 1.6 HasDecimals="False" -->
                                                <Controls:NumericUpDown Minimum="0" Maximum="100" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                DockPanel.Dock="Right"
                                                                MinWidth="100"
                                                                >
                                                    <Controls:NumericUpDown.Value>
                                                        <Binding Path="PowerLevel" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </Controls:NumericUpDown.Value>
                                                </Controls:NumericUpDown>
                                                <Label Content="{x:Static localization:Strings.Or}" Margin="5" DockPanel.Dock="Right"/>
                                                <Slider 
                                                    Value="{Binding PowerLevel}" 
                                                    Maximum="100" Minimum="0" 
                                                    Interval="1"
                                                    IsSnapToTickEnabled="True"
                                                    Margin="5"
                                                    />
                                            </DockPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Tax rate -->
                                <GroupBox
                                    Margin="0,2">
                                    <GroupBox.Style>
                                        <Style TargetType="GroupBox" BasedOn="{StaticResource WithoutHeaderGroupBox}">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <DataTrigger 
                                                Binding="{Binding ElementName=tglGeneralTaxRate, Path=IsChecked }"
                                                Value="True"
                                                >
                                                    <Setter Property="BorderThickness" Value="1"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </GroupBox.Style>
                                    <StackPanel>
                                        <DockPanel>
                                            <Rectangle 
                                                DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.TooltipApplyTaxRate}" 
                                                Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                <Rectangle.Resources>
                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                </Rectangle.Resources>
                                            </Rectangle>


                                            <ToggleButton 
                                                x:Name="tglGeneralTaxRate"
                                                DockPanel.Dock="Right"
                                                Style="{StaticResource EditToggleButton}"/>

                                            <CheckBox 
                                                x:Name="ckbApplyTaxes" 
                                                Content="{x:Static localization:Strings.ApplyTaxRateToResult}" 
                                                IsChecked="{Binding ApplyTaxRate}" Margin="2,5,5,5" MinHeight="32"/>

                                        </DockPanel>
                                        <!-- Settings -->
                                        <StackPanel
                                            Visibility="{Binding ElementName=tglGeneralTaxRate, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                            >
                                            <!-- Tax rate -->
                                            <DockPanel>
                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                    <Rectangle.OpacityMask>
                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Calculator}" />
                                                    </Rectangle.OpacityMask>
                                                </Rectangle>
                                                <Label Content="{x:Static localization:Strings.LabelTaxRate}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                                <Label Content="%" DockPanel.Dock="Right" Margin="10,5,5,5" MinWidth="92"/>
                                                <!-- Mahapps 1.6 HasDecimals="False" -->
                                                <Controls:NumericUpDown 
                                                    x:Name="nudTaxRate" Minimum="0"  Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                    ToolTip="{x:Static localization:Strings.TooltipTaxRate}">
                                                    <Controls:NumericUpDown.Value>
                                                        <Binding Path="Taxrate" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                            <Binding.ValidationRules>
                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                            </Binding.ValidationRules>
                                                        </Binding>
                                                    </Controls:NumericUpDown.Value>
                                                    <Controls:NumericUpDown.Style>
                                                        <Style TargetType="{x:Type Controls:NumericUpDown}" BasedOn="{StaticResource DefaultNumericUpDown}">
                                                            <Setter Property="IsEnabled" Value="True" />
                                                        </Style>
                                                    </Controls:NumericUpDown.Style>
                                                </Controls:NumericUpDown>

                                            </DockPanel>
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>


                                <!-- Margins -->
                                <DockPanel>
                                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                        <Rectangle.OpacityMask>
                                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=ChartDonut}" />
                                        </Rectangle.OpacityMask>
                                    </Rectangle>
                                    <Label Content="{x:Static localization:Strings.LabelMargin}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                    <Label Content=" %" Margin="5" DockPanel.Dock="Right" MinWidth="92"/>
                                    <!-- Mahapps 1.6 HasDecimals="False" -->
                                    <Controls:NumericUpDown Minimum="0" Maximum="1000"  Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                            ToolTip="{x:Static localization:Strings.TooltipPieces}" DockPanel.Dock="Right"
                                                            MinWidth="100"
                                                            >
                                        <Controls:NumericUpDown.Value>
                                            <Binding Path="Margin" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </Controls:NumericUpDown.Value>
                                    </Controls:NumericUpDown>
                                    <Label Content="{x:Static localization:Strings.Or}" Margin="5" DockPanel.Dock="Right"/>
                                    <Slider 
                                        Value="{Binding Margin}" 
                                        Maximum="1000" Minimum="0" 
                                        Interval="1"
                                        IsSnapToTickEnabled="True"
                                        Margin="5"
                                        ToolTip="{x:Static localization:Strings.TooltipMargin}"
                                        />
                                </DockPanel>
                                <!-- Enahnced margin settings -->
                                <GroupBox
                                    Margin="0,2">
                                    <GroupBox.Style>
                                        <Style TargetType="GroupBox" BasedOn="{StaticResource WithoutHeaderGroupBox}">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <DataTrigger 
                                                    Binding="{Binding ElementName=tglAdvancedMarginSettings, Path=IsChecked }"
                                                    Value="True"
                                                    >
                                                    <Setter Property="BorderThickness" Value="1"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </GroupBox.Style>
                                    <StackPanel>
                                        <DockPanel>
                                            <Rectangle 
                                                DockPanel.Dock="Right" Width="24" Height="24" 
                                                ToolTip="{x:Static localization:Strings.TooltipApplyEnhancedMarginCalculationSettings}" 
                                                Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                <Rectangle.Resources>
                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                </Rectangle.Resources>
                                            </Rectangle>


                                            <ToggleButton 
                                                x:Name="tglAdvancedMarginSettings"
                                                DockPanel.Dock="Right"
                                                Style="{StaticResource EditToggleButton}"/>

                                            <CheckBox 
                                                x:Name="ckbApplyAdvancedMarginSettings" 
                                                Content="{x:Static localization:Strings.ApplyEnhancedMarginCalculationSettings}" 
                                                IsChecked="{Binding ApplyEnhancedMarginSettings}" Margin="2,5,5,5" MinHeight="32"/>

                                        </DockPanel>
                                        <!-- Settings -->
                                        <StackPanel
                                            Visibility="{Binding ElementName=tglAdvancedMarginSettings, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                            >
                                            <!-- Exclude -->
                                            <!-- Open Calculation -->
                                            <TextBlock 
                                                Style="{StaticResource HeaderTextBlock}" 
                                                Text="{x:Static localization:Strings.ExcludeFromMarginCalculation}" 
                                                />
                                            <Controls:ToggleSwitch 
                                                Header="{x:Static localization:Strings.ExcludePrinterCostsFromMarginCalculation}" 
                                                OnContent="{x:Static localization:Strings.On}" 
                                                OffContent="{x:Static localization:Strings.Off}" 
                                                IsOn="{Binding ExcludePrinterCostsFromMarginCalculation}" 
                                                Margin="0,0,0,10"
                                                />
                                            <Controls:ToggleSwitch 
                                                Header="{x:Static localization:Strings.ExcludeMaterialCostsFromMarginCalculation}" 
                                                OnContent="{x:Static localization:Strings.On}" 
                                                OffContent="{x:Static localization:Strings.Off}" 
                                                IsOn="{Binding ExcludeMaterialCostsFromMarginCalculation}" 
                                                Margin="0,0,0,10"
                                                />
                                            <Controls:ToggleSwitch 
                                                Header="{x:Static localization:Strings.ExcludeWorkstepsFromMarginCalculation}" 
                                                OnContent="{x:Static localization:Strings.On}" 
                                                OffContent="{x:Static localization:Strings.Off}" 
                                                IsOn="{Binding ExcludeWorkstepsFromMarginCalculation}" 
                                                Margin="0,0,0,10"
                                                />
                                        </StackPanel>
                                    </StackPanel>
                                </GroupBox>
                                
                                
                                <!-- Fail Rate -->
                                <DockPanel>
                                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                        <Rectangle.OpacityMask>
                                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=ProgressAlert}" />
                                        </Rectangle.OpacityMask>
                                    </Rectangle>
                                    <Label Content="{x:Static localization:Strings.LabelFailRate}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                    <Label Content=" %" Margin="5" DockPanel.Dock="Right" MinWidth="92"/>
                                    <!-- Mahapps 1.6 HasDecimals="False" -->
                                    <Controls:NumericUpDown Minimum="0" Maximum="100" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                            ToolTip="{x:Static localization:Strings.TooltipFailRate}" DockPanel.Dock="Right"
                                                            MinWidth="100"
                                                            >
                                        <Controls:NumericUpDown.Value>
                                            <Binding Path="FailRate" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                    <validators:GreaterThanZeroValidator AllowZero="True" ValidatesOnTargetUpdated="True" />
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </Controls:NumericUpDown.Value>
                                    </Controls:NumericUpDown>
                                    <Label Content="{x:Static localization:Strings.Or}" Margin="5" DockPanel.Dock="Right"/>
                                    <Slider 
                                        Value="{Binding FailRate}" Maximum="100" Minimum="0" Margin="5"
                                        Interval="1"
                                        IsSnapToTickEnabled="True"
                                        ToolTip="{x:Static localization:Strings.TooltipFailRate}"
                                        />
                                </DockPanel>

                                <!-- Handling Fee -->
                                <DockPanel>
                                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                        <Rectangle.OpacityMask>
                                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:MaterialDesign Kind=PlayForWork}" />
                                        </Rectangle.OpacityMask>
                                    </Rectangle>
                                    <Label Content="{x:Static localization:Strings.LabelHandlingFee}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                    <Label Content="" DockPanel.Dock="Right" Margin="5" MinWidth="92"/>
                                    <!-- Mahapps 1.6 HasDecimals="False" -->
                                    <Controls:NumericUpDown Minimum="0" StringFormat="C2" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                            ToolTip="{x:Static localization:Strings.TooltipHandlingFee}"
                                                            >
                                        <Controls:NumericUpDown.Value>
                                            <Binding Path="HandlingFee" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                <Binding.ValidationRules>
                                                </Binding.ValidationRules>
                                            </Binding>
                                        </Controls:NumericUpDown.Value>
                                    </Controls:NumericUpDown>
                                </DockPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </TabItem>

                <!-- Procedure specific -->
                <TabItem Header="{x:Static localization:Strings.Procedure}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <!-- Header information -->
                        <StackPanel>
                            <DockPanel>
                                <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoProcedureSpecificAdditions}" 
                                            Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                    <Rectangle.Resources>
                                        <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                    </Rectangle.Resources>
                                </Rectangle>
                                <CheckBox x:Name="ckbProcedureSpecificAdditions" 
                                          Content="{x:Static localization:Strings.ApplyProcedureSpecificAdditions}" 
                                          IsChecked="{Binding ApplyProcedureSpecificAdditions}" Margin="12,5,5,5" MinHeight="32"/>
                            </DockPanel>
                            <!-- Select procedure 
                            <DockPanel
                                Visibility="{Binding ApplyProcedureSpecificAdditions, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                >
                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                    <Rectangle.OpacityMask>
                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Printer3dNozzleOutline}" />
                                    </Rectangle.OpacityMask>
                                </Rectangle>
                                <Label 
                                    Content="{x:Static localization:Strings.LabelSelectTargetProcedure}" 
                                    Margin="2" MinWidth="160" VerticalAlignment="Center"/>
        
                                <ComboBox x:Name="cbProcessTechnology" 
                                          ItemsSource="{Binding Procedures}" 
                                          SelectedItem="{Binding Procedure}" 
                                          SelectedIndex="{Binding ProcedureTabIndex}"
                                          Margin="5" Height="38">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Converter={StaticResource EnumDescriptionConverter}}"/>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </DockPanel>-->
                            <!--
                            <DockPanel
                                Visibility="{Binding ApplyProcedureSpecificAdditions, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                >
                                <GroupBox Margin="20,0,0,10">
                                    <GroupBox.Style>
                                        <Style TargetType="{x:Type GroupBox}" BasedOn="{StaticResource WithoutHeaderGroupBox}">
                                            <Setter Property="IsEnabled" Value="True" />
                                        </Style>
                                    </GroupBox.Style>
                                    <StackPanel>
                                        <TextBlock Text="{x:Static localization:Strings.Procedures}" 
                                           TextWrapping="WrapWithOverflow" 
                                           Style="{StaticResource AccentTextBlock}"/>
                                        <CustomControls:MultiSelectListBox
                                            Margin="4"
                                            ItemsSource="{Binding Procedures}" 
                                            SelectedItem="{Binding Procedure, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                            SelectedItemsList="{Binding ProceduresList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                            SelectionMode="Multiple">
                                            <CustomControls:MultiSelectListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <DockPanel>
                                                        <TextBlock Text="{Binding .}" Margin="5" VerticalAlignment="Center" HorizontalAlignment="Left">
                                                            <TextBlock.Style>
                                                                <Style TargetType="{x:Type TextBlock}">
                                                                    <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Gray3}" />
                                                                    <Setter Property="Margin" Value="0,0,10,0" />
                                                                    <Setter Property="VerticalAlignment" Value="Center" />
                                                                    <Setter Property="FontSize" Value="14" />
                                                                    <Setter Property="FontWeight" Value="Bold" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Path=IsMouseOver,RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Value="True" >
                                                                            <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Gray5}" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Path=IsSelected,RelativeSource={RelativeSource AncestorType={x:Type ListBoxItem}}}" Value="True" >
                                                                            <Setter Property="Foreground" Value="{DynamicResource MahApps.Brushes.Accent}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </DockPanel>
                                                </DataTemplate>
                                            </CustomControls:MultiSelectListBox.ItemTemplate>
                                            <CustomControls:MultiSelectListBox.ItemContainerStyle>
                                                <Style TargetType="{x:Type ListBoxItem}">
                                                    <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                                <Border Background="Transparent" BorderThickness="0">
                                                                    <Grid MinHeight="30">
                       
                                                                        <DockPanel>
                                                                            <CheckBox Margin="5,2" IsEnabled="False"
                                                                        IsChecked="{TemplateBinding IsSelected}">
                                                                            </CheckBox>
                                                                            <ContentPresenter />
                                                                        </DockPanel>
                                                                    </Grid>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </CustomControls:MultiSelectListBox.ItemContainerStyle>
                                            <CustomControls:MultiSelectListBox.Template>
                                                <ControlTemplate TargetType="{x:Type ItemsControl}">
                                                    <Border>
                                                        <ItemsPresenter />
                                                    </Border>
                                                </ControlTemplate>
                                            </CustomControls:MultiSelectListBox.Template>
                                            <CustomControls:MultiSelectListBox.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <VirtualizingStackPanel />
                                                </ItemsPanelTemplate>
                                            </CustomControls:MultiSelectListBox.ItemsPanel>
                                        </CustomControls:MultiSelectListBox>
                                    </StackPanel>
                                </GroupBox>
                            </DockPanel>
                            -->
                        </StackPanel>
                        <!-- Content -->
                        <Grid
                            Grid.Row="1"
                            Visibility="{Binding ApplyProcedureSpecificAdditions, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" 
                            >
                            <GroupBox 
                                Margin="5"
                                Style="{StaticResource WithoutHeaderGroupBox}">
                                <!-- Style="{StaticResource TabControlWithoutHeader}" -->
                                <TabControl
                                    SelectedIndex="{Binding ProcedureTabIndex}"
                                    >
                                    <TabItem Header="{x:Static localization:Strings.Filament}">
                                        <ScrollViewer>
                                            <StackPanel>
                                                <!-- Nozzle Wear -->
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>

                                                            <ToggleButton 
                                                                x:Name="tglNozzleWear"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>

                                                            <CheckBox 
                                                                x:Name="ckbFilamentApplyNozzleWearCosts" 
                                                                Content="{x:Static localization:Strings.TakeNozzleWearCoststIntoAccount}" 
                                                                IsChecked="{Binding ApplyNozzleWearCosts}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <!-- 
                                                            Visibility="{Binding ApplyResinGlovesCosts, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" -->
                                                        <StackPanel
                                                            Visibility="{Binding ElementName=tglNozzleWear, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Replacement costs -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Printer3dNozzleOutline}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelReplacemenCostsManadatory}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="C2"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="NozzleReplacementCosts" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Wear factor -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Fuse}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelWearFactorPerPrintJob}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <TextBlock Text="{Binding NozzleWearCostsPerPrintJob, StringFormat={}{0:C2}}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Maximum="100" 
                                                                    Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="{}{0:N2}%"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="NozzleWearFactorPerPrintJob" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                                
                                                <!-- PrintSheet Wear -->
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>

                                                            <ToggleButton 
                                                                x:Name="tglPrintSheetWear"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>

                                                            <CheckBox 
                                                                x:Name="ckbFilamentApplyPrintSheetWearCosts" 
                                                                Content="{x:Static localization:Strings.TakePrintSheetWearCostsIntoAccount}" 
                                                                IsChecked="{Binding ApplyPrintSheetWearCosts}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <StackPanel
                                                            Visibility="{Binding ElementName=tglPrintSheetWear, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Replacement costs -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Layers}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelReplacemenCostsManadatory}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="C2"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="PrintSheetReplacementCosts" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Wear factor -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Fuse}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelWearFactorPerPrintJob}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <TextBlock Text="{Binding PrintSheetWearCostsPerPrintJob, StringFormat={}{0:C2}}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Maximum="100" 
                                                                    Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="{}{0:N2}%"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="PrintSheetWearFactorPerPrintJob" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                                
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                    <TabItem Header="{x:Static localization:Strings.Resin}">
                                        <ScrollViewer>
                                            <StackPanel>
                                                <!-- Gloves -->
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>

                                                            <ToggleButton 
                                                                x:Name="tglGloves"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>

                                                            <CheckBox 
                                                                x:Name="ckbResinApplyGlovesCosts" 
                                                                Content="{x:Static localization:Strings.TakeGlovesCostIntoAccount}" 
                                                                IsChecked="{Binding ApplyResinGlovesCosts}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <!-- 
                                                            Visibility="{Binding ApplyResinGlovesCosts, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" -->
                                                        <StackPanel
                                                            Visibility="{Binding ElementName=tglGloves, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Package Size -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Package}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelAmountOfGlovesInPackage}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="{x:Static localization:Strings.Gloves}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="GlovesInPackage" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Package Price -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Tag}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelGlovesPackagePrice}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <TextBlock Text="{Binding CostPerGlove, StringFormat={}{0:C2}}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="C2"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="GlovesPackagePrice" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Gloves per job -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Hand}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelGlovesPerJob}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="GlovesPerPrintJob" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                                <!-- Isopropanol -->
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>
                                                            <ToggleButton 
                                                                x:Name="tglIsopropanol"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>
                                                            <CheckBox 
                                                                x:Name="ckbResinApplyWashingCosts" 
                                                                Content="{x:Static localization:Strings.TakeWashingIntoAccount}" 
                                                                IsChecked="{Binding ApplyResinWashingCosts}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <!-- Visibility="{Binding ApplyResinWashingCosts, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"-->
                                                        <StackPanel
                                                             Visibility="{Binding ElementName=tglIsopropanol, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Container Size -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=SprayBottle}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelConentOfIsopropanolInContainer}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>
                                                                <Label Content="{x:Static localization:Strings.Liter}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="IsopropanolContainerContent" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Container Price -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Tag}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelIsopropanolContainerPrice}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <TextBlock Text="{Binding CostPerLiterIsopropanol, StringFormat={}{0:C2}}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="IsopropanolContainerPrice" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Isopropanol per printjob -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Hand}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelUsedIsopropanol}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="{x:Static localization:Strings.Liter}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="IsopropanolPerPrintJob" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                                <!-- Filters -->
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>

                                                            <ToggleButton 
                                                                x:Name="tglFilters"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>

                                                            <CheckBox 
                                                                x:Name="ckbResinApplyFilterCosts" 
                                                                Content="{x:Static localization:Strings.TakeFilterCostIntoAccount}" 
                                                                IsChecked="{Binding ApplyResinFilterCosts}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <!-- 
                                                            Visibility="{Binding ApplyResinGlovesCosts, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" -->
                                                        <StackPanel
                                                            Visibility="{Binding ElementName=tglFilters, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Package Size -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Package}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelAmountOfFiltersInPackage}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="{x:Static localization:Strings.Filters}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="FiltersInPackage" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Package Price -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Tag}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelFiltersPackagePrice}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <TextBlock Text="{Binding CostPerFilter, StringFormat={}{0:C2}}" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    StringFormat="C2"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="FiltersPackagePrice" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <!-- Filters per job -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Hand}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelFiltersPerJob}" Margin="2" MinWidth="160" VerticalContentAlignment="Center"/>
                                                                <Label Content="" DockPanel.Dock="Right" Margin="5" MinWidth="92" VerticalContentAlignment="Center"/>
                                                                <Controls:NumericUpDown 
                                                                    Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                    >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="FiltersPerPrintJob" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                    <TabItem Header="{x:Static localization:Strings.Powder}">
                                        <ScrollViewer>
                                            <StackPanel>
                                                <GroupBox 
                                                    Style="{StaticResource WithoutHeaderGroupBox}"
                                                    Margin="5"
                                                    >
                                                    <StackPanel>
                                                        <DockPanel>
                                                            <Rectangle DockPanel.Dock="Right" Width="24" Height="24" ToolTip="{x:Static localization:Strings.InfoPowderRefreshing}" 
                                                                    Style="{StaticResource HelpImageRectangle}" Margin="10,5">
                                                                <Rectangle.Resources>
                                                                    <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource HelpToolTip}" />
                                                                </Rectangle.Resources>
                                                            </Rectangle>

                                                            <ToggleButton 
                                                                x:Name="tglRefreshRate"
                                                                DockPanel.Dock="Right"
                                                                Style="{StaticResource EditToggleButton}"/>

                                                            <CheckBox 
                                                                x:Name="ckbPowderApplyRefreshRate" 
                                                                Content="{x:Static localization:Strings.TakeRefreshIntoAccount}" 
                                                                IsChecked="{Binding ApplySLSRefreshing}" Margin="12,5,5,5" MinHeight="32"/>
                                                        </DockPanel>
                                                        <!-- 
                                                            Visibility="{Binding ApplyResinGlovesCosts, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}" -->
                                                        <StackPanel
                                                            Visibility="{Binding ElementName=tglRefreshRate, Path=IsChecked, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                                                            >
                                                            <!-- Min. needed powder -->
                                                            <DockPanel>
                                                                <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                                                                    <Rectangle.OpacityMask>
                                                                        <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Cube}" />
                                                                    </Rectangle.OpacityMask>
                                                                </Rectangle>
                                                                <Label Content="{x:Static localization:Strings.LabelMinPowderInBuildAreaMandatory}" Margin="2" MinWidth="160" VerticalAlignment="Center"/>

                                                                <Controls:NumericUpDown 
                                                                Minimum="0" Margin="5" Width="Auto" HorizontalAlignment="Stretch"
                                                                ToolTip="{x:Static localization:Strings.ToolTip_EnterMinimumPowderNeededInBuildArea}"
                                                                >
                                                                    <Controls:NumericUpDown.Value>
                                                                        <Binding Path="PowderInBuildArea" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
                                                                            <Binding.ValidationRules>
                                                                                <validators:GreaterThanZeroValidator ValidatesOnTargetUpdated="True" />
                                                                            </Binding.ValidationRules>
                                                                        </Binding>
                                                                    </Controls:NumericUpDown.Value>
                                                                </Controls:NumericUpDown>
                                                            </DockPanel>

                                                            <TextBlock 
                                                            Text="{x:Static localization:Strings.RefreshRateIsTakenFromMaterial}"
                                                            Style="{StaticResource AccentTextBlock}"
                                                            HorizontalAlignment="Center"
                                                            Margin="5"/>
                                                        </StackPanel>
                                                    </StackPanel>
                                                </GroupBox>
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                    <!--
                                    <TabItem Header="{x:Static localization:Strings.Misc}">
                                        <ScrollViewer>
                                            <StackPanel>
                                                <TextBlock 
                                                    Text="{x:Static localization:Strings.NoAdditionsAvailableYetForThisProcedureDots}"
                                                    Style="{StaticResource AccentTextBlock}"
                                                    VerticalAlignment="Center"
                                                    HorizontalAlignment="Center"
                                                    />
                                            </StackPanel>
                                        </ScrollViewer>
                                    </TabItem>
                                    -->
                                </TabControl>
                            </GroupBox>
                        </Grid>
                    </Grid>
                </TabItem>

                
                <!-- Printers -->
                <TabItem>
                    <TabItem.Header>
                        <!-- Header="{x:Static localization:Strings.Printers}" -->
                        <DockPanel>
                            <Controls:Badged 
                                Badge="{Binding SelectedPrintersView.Count}" 
                                BadgePlacementMode="Right"
                                Margin="20,4"
                                DockPanel.Dock="Right"
                                />
                            <TextBlock Text="{x:Static localization:Strings.Printers}" Margin="0,0,0,0" FontSize="16"
                                       FontFamily="{StaticResource MahApps.Fonts.Family.Header}"/>
                        </DockPanel>
                    </TabItem.Header>
                    <ScrollViewer>
                        <StackPanel>
                            <TextBox x:Name="TextBoxSearchPrinter" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="10" Text="{Binding SearchPrinter, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SearchTextBox}" />
                            <CustomControls:MultiSelectListBox x:Name="lbPrinters" Margin="4" Grid.Row="1" 
                                     ItemsSource="{Binding PrinterViews}" 
                                     SelectedItem="{Binding SelectedPrinterView, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                     SelectedItemsList="{Binding SelectedPrintersView, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                     SelectionMode="Multiple">
                                <CustomControls:MultiSelectListBox.GroupStyle>
                                    <GroupStyle>
                                        <GroupStyle.ContainerStyle>
                                            <Style TargetType="{x:Type GroupItem}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate>
                                                            <Expander IsExpanded="True" Style="{StaticResource DefaultExpander}">
                                                                <Expander.Header>
                                                                    <TextBlock Text="{Binding (CollectionViewGroup.Name)}" Style="{StaticResource DefaultTextBlock}" Margin="0" Foreground="{DynamicResource MahApps.Brushes.Gray3}"/>
                                                                </Expander.Header>
                                                                <ItemsPresenter />
                                                            </Expander>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </GroupStyle.ContainerStyle>
                                    </GroupStyle>
                                </CustomControls:MultiSelectListBox.GroupStyle>
                                <CustomControls:MultiSelectListBox.ItemTemplate>
                                    <DataTemplate>
                                        <!-- 
                                        <templates:PrinterViewInfoTemplate />
                                        -->
                                        <templates:PrinterViewInfoCardTemplate />
                                    </DataTemplate>
                                </CustomControls:MultiSelectListBox.ItemTemplate>
                                <CustomControls:MultiSelectListBox.ItemContainerStyle>
                                    <Style TargetType="{x:Type ListBoxItem}">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="6"/>
                                        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                        <Setter Property="IsSelected" Value="{Binding Selected}"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                    <Border Background="Transparent" BorderThickness="0">
                                                        <Grid MinHeight="30">
                                                            <ContentPresenter />
                                                        </Grid>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </CustomControls:MultiSelectListBox.ItemContainerStyle>
                                <!-- BUGFIX This has to be set, to enable mouse wheel scrolling -->
                                <CustomControls:MultiSelectListBox.Template>
                                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                                        <Border>
                                            <ItemsPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </CustomControls:MultiSelectListBox.Template>
                                <CustomControls:MultiSelectListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                        <!--<VirtualizingStackPanel />-->
                                    </ItemsPanelTemplate>
                                </CustomControls:MultiSelectListBox.ItemsPanel>
                            </CustomControls:MultiSelectListBox>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Materials -->
                <TabItem>
                    <TabItem.Header>
                        <!-- Header="{x:Static localization:Strings.Materials}" -->
                        <DockPanel>
                            <Controls:Badged 
                                Badge="{Binding SelectedMaterialsView.Count}" 
                                BadgePlacementMode="Right"
                                Margin="20,4"
                                DockPanel.Dock="Right"
                                />
                            <TextBlock Text="{x:Static localization:Strings.Materials}" Margin="0,0,0,0" FontSize="16"
                                       FontFamily="{StaticResource MahApps.Fonts.Family.Header}"/>
                        </DockPanel>
                    </TabItem.Header>
                    <ScrollViewer>
                        <StackPanel>
                            <TextBox x:Name="TextBoxSearchMaterial" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="10" Text="{Binding SearchMaterial, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource SearchTextBox}" />
                            <CustomControls:MultiSelectListBox x:Name="lbMaterials" Margin="4" Grid.Row="1" 
                                                               ItemsSource="{Binding MaterialViews}" 
                                                               SelectedItem="{Binding SelectedMaterialView, UpdateSourceTrigger=PropertyChanged}" 
                                                               SelectedItemsList="{Binding SelectedMaterialsView, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                               SelectionMode="Multiple">
                                <CustomControls:MultiSelectListBox.GroupStyle>
                                    <GroupStyle>
                                        <GroupStyle.ContainerStyle>
                                            <Style TargetType="{x:Type GroupItem}">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate>
                                                            <Expander IsExpanded="True" Style="{StaticResource DefaultExpander}">
                                                                <Expander.Header>
                                                                    <TextBlock Text="{Binding (CollectionViewGroup.Name)}" Style="{StaticResource DefaultTextBlock}" Margin="0" Foreground="{DynamicResource MahApps.Brushes.Gray3}"/>
                                                                </Expander.Header>
                                                                <ItemsPresenter />
                                                            </Expander>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </GroupStyle.ContainerStyle>

                                    </GroupStyle>
                                </CustomControls:MultiSelectListBox.GroupStyle>
                                <CustomControls:MultiSelectListBox.ItemTemplate>
                                    <DataTemplate>
                                        <!--<templates:MaterialViewInfoTemplate />-->
                                        <templates:MaterialViewInfoCardTemplate />
                                    </DataTemplate>
                                </CustomControls:MultiSelectListBox.ItemTemplate>
                                <CustomControls:MultiSelectListBox.ItemContainerStyle>
                                    <Style TargetType="{x:Type ListBoxItem}">
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="6"/>
                                        <Setter Property="FocusVisualStyle" Value="{x:Null}" />
                                        <Setter Property="IsSelected" Value="{Binding Selected}"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="{x:Type ListBoxItem}">
                                                    <Border Background="Transparent" BorderThickness="0">
                                                        <Grid MinHeight="30">
                                                            <ContentPresenter />
                                                        </Grid>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </CustomControls:MultiSelectListBox.ItemContainerStyle>
                                <!-- BUGFIX This has to be set, to enable mouse wheel scrolling -->
                                <CustomControls:MultiSelectListBox.Template>
                                    <ControlTemplate TargetType="{x:Type ItemsControl}">
                                        <Border>
                                            <ItemsPresenter />
                                        </Border>
                                    </ControlTemplate>
                                </CustomControls:MultiSelectListBox.Template>
                                <CustomControls:MultiSelectListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                        <!--<VirtualizingStackPanel />-->
                                    </ItemsPanelTemplate>
                                </CustomControls:MultiSelectListBox.ItemsPanel>
                            </CustomControls:MultiSelectListBox>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>

            <!-- Button Load -->
            <Button Margin="5,10,5,0" VerticalAlignment="Top" Height="38"
                        Command="{Binding LoadCalculationCommand}" Grid.ColumnSpan="1" Grid.Row="1" Grid.Column="2"
                        >
                <Button.Style>
                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource ImageButton}">
                        <Setter Property="IsEnabled" Value="False" />
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding IsLicenseValid}" Value="True" />
                                </MultiDataTrigger.Conditions>
                                <Setter Property="IsEnabled" Value="True" />
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5"
                               Visibility="{Binding IsLicenseValid, Converter={StaticResource BooleanToVisibilityCollapsedConverter}}"
                               >
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=OpenInApp}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <!-- Pro Only -->
                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5"
                                               Visibility="{Binding IsLicenseValid, Converter={StaticResource BooleanToVisibilityCollapsedReverseConverter}}"
                                               >
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Lock}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <TextBlock Grid.Column="1" Text="{x:Static localization:Strings.Load}" TextAlignment="Center" Margin="10,5" />
                </Grid>
            </Button>

            <!-- Button Calculate -->
            <Button 
                Margin="5,10,5,0" VerticalAlignment="Top" Height="38"
                Command="{Binding CalculateCommand}" Grid.ColumnSpan="1" Grid.Row="1" Grid.Column="4"
                >
                <Button.Style>
                    <Style TargetType="{x:Type Button}" BasedOn="{StaticResource ImageWithTextButton}">
                        <Setter Property="IsEnabled" Value="False" />
                        <Style.Triggers>
                            <MultiDataTrigger>
                                <MultiDataTrigger.Conditions>
                                    <Condition Binding="{Binding Path=SelectedItems.Count, ElementName=lbPrinters, Converter={StaticResource IsMoreOrEqualThanConverter}, ConverterParameter=1}" Value="True" />
                                    <Condition Binding="{Binding Path=SelectedItems.Count, ElementName=lbMaterials, Converter={StaticResource IsMoreOrEqualThanConverter}, ConverterParameter=1}" Value="True" />
                                    <Condition Binding="{Binding Files.Count, Converter={StaticResource IsMoreOrEqualThanConverter}, ConverterParameter=1}" Value="True" />
                                    <Condition Binding="{Binding ElementName=tbName, Path=(Validation.HasError)}" Value="False" />
                                    <!--<Condition Binding="{Binding ElementName=nudVolume, Path=(Validation.HasError)}" Value="False" />-->
                                    <!--<Condition Binding="{Binding ElementName=nudPrintTime, Path=(Validation.HasError)}" Value="False" />-->
                                </MultiDataTrigger.Conditions>

                                <Setter Property="IsEnabled" Value="True" />
                            </MultiDataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Rectangle Width="20" Height="20" Fill="{DynamicResource MahApps.Brushes.Gray3}" Margin="10,5,0,5">
                        <Rectangle.OpacityMask>
                            <VisualBrush Stretch="Uniform" Visual="{iconPacks:Material Kind=Calculator}" />
                        </Rectangle.OpacityMask>
                    </Rectangle>
                    <TextBlock Grid.Column="1" Text="{x:Static localization:Strings.Calculate}" TextAlignment="Center" Margin="10,5" />
                </Grid>
            </Button>
        </Grid>
    </Grid>
</UserControl>
